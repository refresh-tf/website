"use strict";(self.webpackChunkrefresh_website=self.webpackChunkrefresh_website||[]).push([[831],{831:(C,l,s)=>{s.r(l),s.d(l,{loadDatabaseAdapter:()=>S});async function w(n,r="gzip"){const e=Uint8Array.from(atob(n),d=>d.charCodeAt(0)),o=new Response(new Blob([e])).body?.pipeThrough(new DecompressionStream(r)),u=await new Response(o).text();return JSON.parse(u)}var c=s(3375);function f(n,r){const e=g(n),t={...r};for(const o in t)e[o]==="json"&&t[o]&&t[o]!=="undefined"&&(t[o]=JSON.parse(t[o])),e[o]==="boolean"&&t[o]!=="undefined"&&(t[o]=!!t[o]);for(const o in t)t[o]==="NULL"&&(t[o]=void 0);return t}function g(n){const r=n.match(/FROM\s+(\w+)/);return r?c.Ay[h(r[1])]?.fields||{}:{}}function h(n){return n.replace(/^_content_/,"")}var b=s(2670);let a;const m={},i={};function S(n){async function r(e){return a||(i._=i._||p(),a=await i._,Reflect.deleteProperty(i,"_")),m[String(e)]||(i[String(e)]=i[String(e)]||y(e),await i[String(e)],m[String(e)]="loaded",Reflect.deleteProperty(i,String(e))),a}return{all:async(e,t)=>(await r(n),a.exec({sql:e,bind:t,rowMode:"object",returnValue:"resultRows"}).map(o=>f(e,o))),first:async(e,t)=>(await r(n),f(e,a.exec({sql:e,bind:t,rowMode:"object",returnValue:"resultRows"}).shift())),exec:async(e,t)=>{await r(n),await a.exec({sql:e,bind:t})}}}async function p(){if(!a){const n=await Promise.all([s.e(746),s.e(708)]).then(s.bind(s,2708)).then(e=>e.default);globalThis.sqlite3ApiConfig={silent:!0,debug:(...e)=>console.debug(...e),warn:(...e)=>{String(e[0]).includes("OPFS sqlite3_vfs")||console.warn(...e)},error:(...e)=>console.error(...e),log:(...e)=>console.log(...e)};const r=await n();a=new r.oo1.DB}return a}async function y(n){if(window.sessionStorage.getItem("previewToken"))return a;let r=null;const e=`checksum_${n}`,t=`collection_${n}`;let o="matched";try{a.exec({sql:`SELECT * FROM ${c.um.info} where id = '${e}'`,rowMode:"object",returnValue:"resultRows"}).shift()?.version!==c.vw[String(n)]&&(o="mismatch")}catch{o="missing"}if(o!=="matched"){if(window.localStorage.getItem(`content_${e}`)===c.vw[String(n)]&&(r=window.localStorage.getItem(`content_${t}`)),!r){r=await(0,b.m)(void 0,String(n));try{window.localStorage.setItem(`content_${e}`,c.vw[String(n)]),window.localStorage.setItem(`content_${t}`,r)}catch(d){console.error("Database integrity check failed, rebuilding database",d)}}const u=await w(r);await a.exec({sql:`DROP TABLE IF EXISTS ${c.um[String(n)]}`}),o==="mismatch"&&await a.exec({sql:`DELETE FROM ${c.um.info} WHERE id = '${e}'`});for(const d of u)try{await a.exec(d)}catch(F){console.error("Error executing command",F)}}return a}}}]);
